###VM Open5gs
root@Open5GS:~# ps -ef | grep open5gs-
root      284750       1  0 00:25 ?        00:00:00 /root/open5gs/install/bin/open5gs-upfd
root      290745  288248  0 14:04 pts/7    00:00:01 /root/open5gs/install/bin/open5gs-nrfd
root      290752  288248  0 14:04 pts/7    00:00:00 /root/open5gs/install/bin/open5gs-udmd
root      290754  288248  0 14:04 pts/7    00:00:00 /root/open5gs/install/bin/open5gs-ausfd
root      290761  288248  0 14:04 pts/7    00:00:00 /root/open5gs/install/bin/open5gs-pcfd
root      290833  288248  0 14:15 pts/7    00:00:00 /root/open5gs/install/bin/open5gs-amfd
root      290834  288248  0 14:15 pts/7    00:00:00 /root/open5gs/install/bin/open5gs-smfd
root      290989  290977  0 15:49 pts/0    00:00:00 grep --color=auto open5gs-
root@Open5GS:~# ss -lntp | egrep '7777|7778|7779|7780|7781|7782|7776'
ss -lnup | grep 8805   # PFCP
ss -lnp | grep 38412   # NGAP SCTP
LISTEN 0      5        10.10.33.54:7779       0.0.0.0:*    users:(("open5gs-smfd",pid=290834,fd=12))
LISTEN 0      5        10.10.33.54:7778       0.0.0.0:*    users:(("open5gs-amfd",pid=290833,fd=9))
LISTEN 0      5        10.10.33.54:7777       0.0.0.0:*    users:(("open5gs-nrfd",pid=290745,fd=6))
LISTEN 0      5        10.10.33.54:7776       0.0.0.0:*    users:(("open5gs-pcfd",pid=290761,fd=10))
LISTEN 0      5        10.10.33.54:7781       0.0.0.0:*    users:(("open5gs-ausfd",pid=290754,fd=8))
LISTEN 0      5        10.10.33.54:7780       0.0.0.0:*    users:(("open5gs-udmd",pid=290752,fd=8))
UNCONN 0      0        10.10.33.54:8805      0.0.0.0:*    users:(("open5gs-smfd",pid=290834,fd=11))
UNCONN 0      0          127.0.0.7:8805      0.0.0.0:*    users:(("open5gs-upfd",pid=284750,fd=7))
sctp  LISTEN 0      5                                     10.10.33.54:38412            0.0.0.0:*    users:(("open5gs-amfd",pid=290833,fd=10))
root@Open5GS:~# tail -n 50 ~/open5gs/install/var/log/open5gs/amf.log
tail -n 50 ~/open5gs/install/var/log/open5gs/smf.log
12/23 14:19:12.497: [gmm] INFO: Registration request (../src/amf/gmm-sm.c:1339)
12/23 14:19:12.497: [gmm] INFO: [suci-0-999-70-0000-0-0-0000000001]    SUCI (../src/amf/gmm-handler.c:183)
12/23 14:19:12.497: [sbi] INFO: [b1d366a6-dfcd-41f0-8b33-2f32776fbffb] Setup NF Instance [type:AUSF] (../lib/sbi/path.c:307)
12/23 14:19:22.499: [gmm] ERROR: [suci-0-999-70-0000-0-0-0000000001] HTTP response error [504] (../src/amf/gmm-sm.c:1933)
12/23 14:19:22.500: [amf] WARNING: [suci-0-999-70-0000-0-0-0000000001] Registration reject [90] (../src/amf/nas-path.c:213)
12/23 14:19:22.500: [gmm] WARNING: [(null)] Failure in transaction; no context restoration. (../src/amf/gmm-sm.c:1941)
12/23 14:19:22.500: [amf] ERROR: SBI transaction has already been removed [5] (../src/amf/amf-sm.c:755)
12/23 14:19:22.501: [amf] INFO: UE Context Release [Action:3] (../src/amf/ngap-handler.c:1733)
12/23 14:19:22.501: [amf] INFO:     RAN_UE_NGAP_ID[5] AMF_UE_NGAP_ID[5] (../src/amf/ngap-handler.c:1734)
12/23 14:19:22.501: [amf] INFO:     SUCI[suci-0-999-70-0000-0-0-0000000001] (../src/amf/ngap-handler.c:1738)
12/23 14:19:22.501: [amf] INFO: [Removed] Number of gNB-UEs is now 0 (../src/amf/context.c:2796)
12/23 14:19:22.502: [amf] INFO: [Removed] Number of AMF-UEs is now 0 (../src/amf/context.c:1780)
12/23 14:21:29.659: [amf] INFO: gNB-N2[10.10.33.40] connection refused!!! (../src/amf/amf-sm.c:954)
12/23 14:21:29.659: [amf] INFO: [Removed] Number of gNBs is now 0 (../src/amf/context.c:1305)
12/23 14:21:41.056: [amf] INFO: gNB-N2 accepted[10.10.33.40]:37664 in ng-path module (../src/amf/ngap-sctp.c:113)
12/23 14:21:41.056: [amf] INFO: gNB-N2 accepted[10.10.33.40] in master_sm module (../src/amf/amf-sm.c:894)
12/23 14:21:41.069: [amf] INFO: [Added] Number of gNBs is now 1 (../src/amf/context.c:1277)
12/23 14:21:41.070: [amf] INFO: gNB-N2[10.10.33.40] max_num_of_ostreams : 10 (../src/amf/amf-sm.c:941)
12/23 14:21:45.047: [amf] INFO: InitialUEMessage (../src/amf/ngap-handler.c:437)
12/23 14:21:45.048: [amf] INFO: [Added] Number of gNB-UEs is now 1 (../src/amf/context.c:2789)
12/23 14:21:45.048: [amf] INFO:     RAN_UE_NGAP_ID[1] AMF_UE_NGAP_ID[6] TAC[1] CellID[0x10] (../src/amf/ngap-handler.c:598)
12/23 14:21:45.048: [amf] INFO: [suci-0-999-70-0000-0-0-0000000001] Unknown UE by SUCI (../src/amf/context.c:1906)
12/23 14:21:45.048: [amf] INFO: [Added] Number of AMF-UEs is now 1 (../src/amf/context.c:1682)
12/23 14:21:45.048: [gmm] INFO: Registration request (../src/amf/gmm-sm.c:1339)
12/23 14:21:45.049: [gmm] INFO: [suci-0-999-70-0000-0-0-0000000001]    SUCI (../src/amf/gmm-handler.c:183)
12/23 14:21:45.049: [sbi] INFO: [b1d366a6-dfcd-41f0-8b33-2f32776fbffb] Setup NF Instance [type:AUSF] (../lib/sbi/path.c:307)
12/23 14:21:55.051: [amf] ERROR: [(null):suci-0-999-70-0000-0-0-0000000001] Cannot receive SBI message (../src/amf/amf-sm.c:784)
12/23 14:21:55.051: [amf] WARNING: [suci-0-999-70-0000-0-0-0000000001] Registration reject [90] (../src/amf/nas-path.c:213)
12/23 14:21:55.056: [amf] ERROR: SBI transaction has already been removed [6] (../src/amf/amf-sm.c:472)
12/23 14:22:05.064: [gmm] WARNING: Registration request (../src/amf/gmm-sm.c:1853)
12/23 14:22:05.064: [gmm] INFO: [suci-0-999-70-0000-0-0-0000000001]    SUCI (../src/amf/gmm-handler.c:183)
12/23 14:22:05.065: [amf] WARNING: GUTI has already been allocated (../src/amf/context.c:1482)
12/23 14:22:15.067: [amf] ERROR: [(null):suci-0-999-70-0000-0-0-0000000001] Cannot receive SBI message (../src/amf/amf-sm.c:784)
12/23 14:22:15.068: [amf] WARNING: [suci-0-999-70-0000-0-0-0000000001] Registration reject [90] (../src/amf/nas-path.c:213)
12/23 14:22:15.069: [amf] ERROR: SBI transaction has already been removed [7] (../src/amf/amf-sm.c:472)
12/23 14:22:25.083: [gmm] WARNING: Registration request (../src/amf/gmm-sm.c:1853)
12/23 14:22:25.083: [gmm] INFO: [suci-0-999-70-0000-0-0-0000000001]    SUCI (../src/amf/gmm-handler.c:183)
12/23 14:22:25.083: [amf] WARNING: GUTI has already been allocated (../src/amf/context.c:1482)
12/23 14:22:35.087: [amf] ERROR: [(null):suci-0-999-70-0000-0-0-0000000001] Cannot receive SBI message (../src/amf/amf-sm.c:784)
12/23 14:22:35.088: [amf] WARNING: [suci-0-999-70-0000-0-0-0000000001] Registration reject [90] (../src/amf/nas-path.c:213)
12/23 14:22:35.088: [amf] ERROR: SBI transaction has already been removed [8] (../src/amf/amf-sm.c:472)
12/23 14:22:45.103: [gmm] WARNING: Registration request (../src/amf/gmm-sm.c:1853)
12/23 14:22:45.103: [gmm] INFO: [suci-0-999-70-0000-0-0-0000000001]    SUCI (../src/amf/gmm-handler.c:183)
12/23 14:22:45.103: [amf] WARNING: GUTI has already been allocated (../src/amf/context.c:1482)
12/23 14:22:55.106: [amf] ERROR: [(null):suci-0-999-70-0000-0-0-0000000001] Cannot receive SBI message (../src/amf/amf-sm.c:784)
12/23 14:22:55.107: [amf] WARNING: [suci-0-999-70-0000-0-0-0000000001] Registration reject [90] (../src/amf/nas-path.c:213)
12/23 14:22:55.107: [amf] ERROR: SBI transaction has already been removed [9] (../src/amf/amf-sm.c:472)
12/23 14:22:56.215: [amf] INFO: gNB-N2[10.10.33.40] connection refused!!! (../src/amf/amf-sm.c:954)
12/23 14:22:56.215: [amf] INFO: [Removed] Number of gNB-UEs is now 0 (../src/amf/context.c:2796)
12/23 14:22:56.216: [amf] INFO: [Removed] Number of gNBs is now 0 (../src/amf/context.c:1305)
12/23 14:06:58.153: [smf] ERROR: [imsi-999700000000001:1] Cannot receive SBI message (../src/smf/smf-sm.c:1089)
12/23 14:06:58.163: [smf] ERROR: SBI transaction has already been removed [2] (../src/smf/smf-sm.c:847)
12/23 14:15:00.394: [sbi] INFO: [b1ce5b70-dfcd-41f0-a485-35cab94797b0] (NRF-notify) NF_DEREGISTERED event [type:AMF] (../lib/sbi/nnrf-handler.c:1172)
12/23 14:15:00.406: [app] INFO: SIGTERM received (../src/main.c:54)
12/23 14:15:00.406: [app] INFO: Open5GS daemon terminating... (../src/main.c:231)
12/23 14:15:00.406: [sbi] INFO: [b1e680ba-dfcd-41f0-866b-4325bc25ce81] NF de-registered (../lib/sbi/nf-sm.c:324)
12/23 14:15:00.408: [smf] INFO: PFCP de-associated [10.10.33.60]:8805 (../src/smf/pfcp-sm.c:204)
12/23 14:15:00.528: [smf] INFO: Removed Session: UE IMSI:[imsi-999700000000001] DNN:[internet:1] IPv4:[] IPv6:[] (../src/smf/context.c:1701)
12/23 14:15:00.528: [smf] INFO: [Removed] Number of SMF-Sessions is now 0 (../src/smf/context.c:3211)
12/23 14:15:00.528: [smf] INFO: [Removed] Number of SMF-UEs is now 0 (../src/smf/context.c:1097)
12/23 14:15:00.534: [app] INFO: SMF terminate...done (../src/smf/app.c:39)
Open5GS daemon v2.7.6

12/23 14:15:22.423: [app] INFO: Configuration: '/root/open5gs/install/etc/open5gs/smf.yaml' (../lib/app/ogs-init.c:144)
12/23 14:15:22.423: [app] INFO: File Logging: '/root/open5gs/install/var/log/open5gs/smf.log' (../lib/app/ogs-init.c:147)
12/23 14:15:22.529: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/context.c:459)
12/23 14:15:22.530: [metrics] INFO: metrics_server() [http://127.0.0.4]:9090 (../lib/metrics/prometheus/context.c:300)
12/23 14:15:22.530: [smf] WARNING: No diameter configuration (../src/smf/fd-path.c:30)
12/23 14:15:22.530: [gtp] INFO: gtp_server() [10.10.33.54]:2123 (../lib/gtp/path.c:30)
12/23 14:15:22.530: [gtp] INFO: gtp_server() [10.10.33.54]:2152 (../lib/gtp/path.c:30)
12/23 14:15:22.530: [pfcp] INFO: pfcp_server() [10.10.33.54]:8805 (../lib/pfcp/path.c:30)
12/23 14:15:22.530: [sbi] INFO: NF Service [nsmf-pdusession] (../lib/sbi/context.c:1994)
12/23 14:15:22.531: [sbi] INFO: nghttp2_server() [http://10.10.33.54]:7779 (../lib/sbi/nghttp2-server.c:439)
12/23 14:15:22.531: [app] INFO: SMF initialize...done (../src/smf/app.c:31)
12/23 14:15:22.532: [smf] INFO: PFCP associated [10.10.33.60]:8805 (../src/smf/pfcp-sm.c:188)
12/23 14:15:22.533: [sbi] INFO: [2548021c-dfcf-41f0-9689-9daf42691eb6] NF registered [Heartbeat:10s] (../lib/sbi/nf-sm.c:295)
12/23 14:15:22.534: [smf] WARNING: PFCP[REQ] has already been associated [10.10.33.60]:8805 (../src/smf/pfcp-sm.c:286)
12/23 14:15:22.535: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/nnrf-handler.c:955)
12/23 14:15:22.535: [sbi] INFO: [254a60de-dfcf-41f0-a11a-0ffe0915da80] Subscription created until 2025-12-24T14:15:22.534191+07:00 [duration:86400000000,validity:86400.000000,patch:43200.000000] (../lib/sbi/nnrf-handler.c:874)
12/23 14:15:22.536: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/nnrf-handler.c:955)
12/23 14:15:22.536: [sbi] INFO: [254a7268-dfcf-41f0-a11a-0ffe0915da80] Subscription created until 2025-12-24T14:15:22.534678+07:00 [duration:86400000000,validity:86400.000000,patch:43200.000000] (../lib/sbi/nnrf-handler.c:874)
12/23 14:15:22.536: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/nnrf-handler.c:955)
12/23 14:15:22.536: [sbi] INFO: [254a7c5e-dfcf-41f0-a11a-0ffe0915da80] Subscription created until 2025-12-24T14:15:22.534869+07:00 [duration:86400000000,validity:86400.000000,patch:43200.000000] (../lib/sbi/nnrf-handler.c:874)
12/23 14:15:22.536: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/nnrf-handler.c:955)
12/23 14:15:22.536: [sbi] INFO: [254a83b6-dfcf-41f0-a11a-0ffe0915da80] Subscription created until 2025-12-24T14:15:22.535094+07:00 [duration:86400000000,validity:86400.000000,patch:43200.000000] (../lib/sbi/nnrf-handler.c:874)
12/23 14:15:22.536: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7777] (../lib/sbi/nnrf-handler.c:955)
12/23 14:15:22.536: [sbi] INFO: [254a959a-dfcf-41f0-a11a-0ffe0915da80] Subscription created until 2025-12-24T14:15:22.535535+07:00 [duration:86400000000,validity:86400.000000,patch:43200.000000] (../lib/sbi/nnrf-handler.c:874)
12/23 14:15:22.539: [sbi] INFO: [b1d3c70e-dfcd-41f0-9fe4-45b472e8471d] (NRF-profile-get) NF registered (../lib/sbi/nf-sm.c:81)
12/23 14:15:22.539: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:80] (../lib/sbi/context.c:2374)
12/23 14:15:22.539: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7780] (../lib/sbi/context.c:2113)
12/23 14:15:22.539: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7780] (../lib/sbi/context.c:2113)
12/23 14:15:22.539: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7780] (../lib/sbi/context.c:2113)
12/23 14:15:22.540: [sbi] INFO: [b1dd3ce4-dfcd-41f0-8b48-23e088a1ecc6] (NRF-profile-get) NF registered (../lib/sbi/nf-sm.c:81)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:80] (../lib/sbi/context.c:2374)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7776] (../lib/sbi/context.c:2113)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7776] (../lib/sbi/context.c:2113)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7776] (../lib/sbi/context.c:2113)
12/23 14:15:22.540: [sbi] INFO: [253a2692-dfcf-41f0-a939-59fa4fca07db] (NRF-profile-get) NF registered (../lib/sbi/nf-sm.c:81)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:80] (../lib/sbi/context.c:2374)
12/23 14:15:22.540: [sbi] INFO: Setup NF EndPoint(addr) [10.10.33.54:7778] (../lib/sbi/context.c:2113)


###VM2 Masterk8s
root@MasterK8s:~# kubectl get nodes -o wide
kubectl get pods -A -o wide
NAME        STATUS   ROLES           AGE   VERSION    INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME
masterk8s   Ready    control-plane   10d   v1.30.14   10.10.33.45     <none>        Ubuntu 22.04.5 LTS   5.15.0-164-generic   containerd://1.7.28
workerk8s   Ready    <none>          10d   v1.30.14   103.121.91.87   <none>        Ubuntu 22.04.5 LTS   5.15.0-164-generic   containerd://1.7.28
NAMESPACE     NAME                                       READY   STATUS    RESTARTS        AGE   IP               NODE        NOMINATED NODE   READINESS GATES
default       multus-test-pod                            1/1     Running   242 (36m ago)   10d   192.168.30.132   workerk8s   <none>           <none>
kube-system   calico-kube-controllers-78b7fdb74b-554nk   1/1     Running   0               10d   192.168.30.129   workerk8s   <none>           <none>
kube-system   calico-node-m8vg8                          0/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   calico-node-rhdbt                          0/1     Running   0               10d   103.121.91.87    workerk8s   <none>           <none>
kube-system   coredns-55cb58b774-2gpc8                   1/1     Running   0               10d   192.168.30.130   workerk8s   <none>           <none>
kube-system   coredns-55cb58b774-hqzcw                   1/1     Running   0               10d   192.168.30.131   workerk8s   <none>           <none>
kube-system   etcd-masterk8s                             1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   kube-apiserver-masterk8s                   1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   kube-controller-manager-masterk8s          1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   kube-multus-ds-6fxjb                       1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   kube-multus-ds-chwvg                       1/1     Running   0               10d   103.121.91.87    workerk8s   <none>           <none>
kube-system   kube-proxy-4bdf7                           1/1     Running   0               10d   103.121.91.87    workerk8s   <none>           <none>
kube-system   kube-proxy-xrpdq                           1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
kube-system   kube-scheduler-masterk8s                   1/1     Running   0               10d   10.10.33.45      masterk8s   <none>           <none>
open5gs       upf-57445865cb-6xqmj                       1/1     Running   0               17h   103.121.91.87    workerk8s   <none>           <none>
root@MasterK8s:~# kubectl get svc -A
kubectl get net-attach-def -A   # n·∫øu d√πng Multus
NAMESPACE     NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
default       kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP                  10d
kube-system   kube-dns     ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP,9153/TCP   10d
NAMESPACE   NAME       AGE
default     net-test   10d
root@MasterK8s:~#
root@MasterK8s:~# ufw status
Status: inactive


###VM3 Workerk8s
root@WorkerK8s:~# export KUBECONFIG=/root/admin.conf
root@WorkerK8s:~# kubectl get pods -n open5gs -o wide
kubectl logs -n open5gs deploy/upf | tail -n 50
NAME                   READY   STATUS    RESTARTS   AGE   IP              NODE                                                                                                                                                                     NOMINATED NODE   READINESS GATES
upf-57445865cb-6xqmj   1/1     Running   0          17h   103.121.91.87   worker                                                                                                                                                             k8s   <none>           <none>
12/23 04:23:17.380: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 04:23:17.380: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 04:30:52.684: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 04:30:52.684: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 04:30:52.686: [pfcp] ERROR: Remote PFCP restarted [3975452597<3975453052]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 04:30:52.687: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 04:30:52.686: [pfcp] ERROR: Remote PFCP restarted [3975452597<3975453052]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 04:30:52.687: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 04:30:52.689: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 04:30:52.689: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 04:30:52.689: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 04:30:52.689: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 06:47:16.238: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 06:47:16.238: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 06:47:16.240: [pfcp] ERROR: Remote PFCP restarted [3975453052<3975461235]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 06:47:16.240: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 06:47:16.240: [pfcp] ERROR: Remote PFCP restarted [3975453052<3975461235]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 06:47:16.240: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 06:47:16.243: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 06:47:16.243: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 06:47:16.243: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 06:47:16.243: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 07:04:59.622: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 07:04:59.622: [upf] WARNING: PFCP[REQ] has already been associated [10.10.                                                                                                                                                             33.54]:8805 (../src/upf/pfcp-sm.c:256)
12/23 07:04:59.625: [pfcp] ERROR: Remote PFCP restarted [3975461235<3975462299]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 07:04:59.625: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:04:59.625: [pfcp] ERROR: Remote PFCP restarted [3975461235<3975462299]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 07:04:59.625: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:04:59.629: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:04:59.629: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 07:04:59.629: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:04:59.629: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 07:15:12.420: [pfcp] WARNING: [5133] LOCAL  No Reponse. Give up! for step                                                                                                                                                              1 type 1 peer [10.10.33.54]:8805 (../lib/pfcp/xact.c:602)
12/23 07:15:12.421: [upf] WARNING: No Heartbeat from SMF [10.10.33.54]:8805 (../                                                                                                                                                             src/upf/pfcp-sm.c:309)
12/23 07:15:12.421: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:15:12.420: [pfcp] WARNING: [5133] LOCAL  No Reponse. Give up! for step                                                                                                                                                              1 type 1 peer [10.10.33.54]:8805 (../lib/pfcp/xact.c:602)
12/23 07:15:12.420: [upf] WARNING: No Heartbeat from SMF [10.10.33.54]:8805 (../                                                                                                                                                             src/upf/pfcp-sm.c:309)
12/23 07:15:12.421: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:15:19.927: [pfcp] WARNING: [5134] LOCAL  No Reponse. Give up! for step                                                                                                                                                              1 type 5 peer [10.10.33.54]:8805 (../lib/pfcp/xact.c:602)
12/23 07:15:19.927: [pfcp] WARNING: [5134] LOCAL  No Reponse. Give up! for step                                                                                                                                                              1 type 5 peer [10.10.33.54]:8805 (../lib/pfcp/xact.c:602)
12/23 07:15:22.515: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:15:22.515: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:15:22.517: [pfcp] ERROR: Remote PFCP restarted [3975462299<3975462922]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 07:15:22.517: [pfcp] ERROR: Remote PFCP restarted [3975462299<3975462922]                                                                                                                                                              in Heartbeat REQ (../lib/pfcp/handler.c:39)
12/23 07:15:22.517: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:15:22.517: [upf] INFO: PFCP de-associated [10.10.33.54]:8805 (../src/up                                                                                                                                                             f/pfcp-sm.c:184)
12/23 07:15:22.519: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:15:22.519: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
12/23 07:15:22.519: [upf] INFO: PFCP associated [10.10.33.54]:8805 (../src/upf/p                                                                                                                                                             fcp-sm.c:168)
12/23 07:15:22.519: [upf] ERROR: PFCP restoration (../src/upf/pfcp-sm.c:178)
root@WorkerK8s:~# kubectl exec -it -n open5gs deploy/upf -- cat /etc/open5gs/upf                                                                                                                                                             .yaml
#logger:
#  file:
#    path: /var/log/open5gs/upf.log
logger:
  file:
    path: /dev/stdout
  level: info   # fatal|error|warn|info(default)|debug|trace

global:
  max:
    ue: 1024
    peer: 64

upf:
  pfcp:
    server:
      - address: 10.10.33.60
#      - address: 10.10.33.60
    client:
      smf:
        - address: 10.10.33.54   # IP c·ªßa SMF tr√™n VM1
  gtpu:
    server:
      - address: 10.10.33.60
#      - address: 10.10.33.60
  session:
    - subnet: 10.45.0.0/16
      gateway: 10.45.0.1
    - subnet: 2001:db8:cafe::/48
      gateway: 2001:db8:cafe::1
  metrics:
    server:
      - address: 0.0.0.0
#      - address: 10.10.33.60
        port: 9090
root@WorkerK8s:~#
root@WorkerK8s:~# ip addr show ogstun
39: ogstun: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 500
    link/none
    inet 10.45.0.1/16 scope global ogstun
       valid_lft forever preferred_lft forever
    inet6 fe80::c3f9:47c3:8c6e:1bb8/64 scope link stable-privacy
       valid_lft forever preferred_lft forever

root@WorkerK8s:~# ufw status
Status: inactive

###k·∫øt lu·∫≠n Copilot
VM1 ‚Äì Open5GS Core (10.10.33.54)
C√°c ti·∫øn tr√¨nh NF (NRF, AMF, SMF, UDM, AUSF, PCF) ƒë·ªÅu ƒëang ch·∫°y.

C√°c c·ªïng SBI (7777‚Äì7782), NGAP (38412 SCTP), PFCP (8805 UDP) ƒë·ªÅu l·∫Øng nghe ƒë√∫ng tr√™n IP 10.10.33.54.

Log AMF/SMF: c√≥ Registration Request t·ª´ UE, nh∆∞ng b√°o l·ªói Cannot receive SBI message, Registration reject [90], create_sm_context failed [504]. üëâ ƒêi·ªÅu n√†y cho th·∫•y AMF ‚Üî SMF SBI ch∆∞a ·ªïn ƒë·ªãnh, ho·∫∑c gNB/N2 b·ªã r·ªõt gi·ªØa ch·ª´ng. Nh∆∞ng v·ªÅ m·∫∑t ‚ÄúNF ƒë√£ kh·ªüi ƒë·ªông v√† l·∫Øng nghe‚Äù th√¨ ·ªïn.

üìå VM2 ‚Äì K8s Master (10.10.33.45)
Cluster c√≥ 2 node: masterk8s (10.10.33.45) v√† workerk8s (103.121.91.87). C·∫£ hai ƒë·ªÅu Ready.

Pod h·ªá th·ªëng (calico, coredns, etcd, apiserver‚Ä¶) ƒë·ªÅu Running.

UPF pod trong namespace open5gs ƒëang Running tr√™n node workerk8s.

Multus ƒë√£ c√†i, c√≥ net-attach-def net-test. üëâ Cluster ·ªïn ƒë·ªãnh, UPF pod ƒë√£ ch·∫°y.

üìå VM3 ‚Äì K8s Worker (10.10.33.60)
UPF pod Running.

Log UPF: PFCP association v·ªõi SMF (10.10.33.54:8805) c√≥, nh∆∞ng nhi·ªÅu l·∫ßn b√°o ‚ÄúPFCP restoration‚Äù, ‚ÄúRemote PFCP restarted‚Äù, ‚ÄúNo Heartbeat from SMF‚Äù. üëâ Nghƒ©a l√† PFCP c√≥ l√∫c m·∫•t k·∫øt n·ªëi r·ªìi kh√¥i ph·ª•c l·∫°i. Kh√¥ng ph·∫£i l·ªói c·∫•u h√¨nh, nh∆∞ng c·∫ßn ki·ªÉm tra ·ªïn ƒë·ªãnh m·∫°ng gi·ªØa VM1 ‚Üî VM3.

File upf.yaml: ƒë√∫ng, PFCP server 10.10.33.60, client SMF 10.10.33.54, GTP-U server 10.10.33.60, subnet UE 10.45.0.0/16.

Interface ogstun: ƒë√£ c√≥ IP 10.45.0.1/16. üëâ UPF ·ªïn, nh∆∞ng PFCP heartbeat ch∆∞a ·ªïn ƒë·ªãnh.

üìå K·∫øt lu·∫≠n hi·ªán t·∫°i
NF Core v√† UPF ƒë·ªÅu ch·∫°y, cluster ·ªïn ƒë·ªãnh.

ƒêi·ªÉm ch∆∞a ·ªïn: AMF ‚Üî SMF SBI v√† AMF ‚Üî gNB N2. ƒê√¢y l√† nguy√™n nh√¢n UE b·ªã reject.

Prometheus/Grafana, MEC App ch∆∞a c√†i.


###
üìå M√¥ h√¨nh hi·ªán t·∫°i b·∫°n ƒëang tri·ªÉn khai
VM1 (10.10.33.54): Open5GS Core (NRF, AMF, SMF, UDM, AUSF, UDR, PCF) + Prometheus + Grafana.

VM2 (10.10.33.45): K8s Master.

VM3 (10.10.33.60): K8s Worker + UPF (ch·∫°y trong Pod) + MEC App.

VM4 (10.10.33.40): UERANSIM (gNB + UE).

üëâ ƒê√¢y l√† m√¥ h√¨nh chu·∫©n: RAN (UERANSIM) ‚Üî Core (Open5GS) ‚Üî UPF ‚Üî MEC App.

üìå V·∫•n ƒë·ªÅ
UERANSIM (UE/gNB) kh√¥ng ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh, d·∫´n ƒë·∫øn kh√¥ng th·ªÉ t·∫°o PDU session.

B·∫°n c·∫ßn ph∆∞∆°ng √°n thay th·∫ø UE ƒë·ªÉ v·∫´n m√¥ ph·ªèng ƒë∆∞·ª£c cho 2 lu·∫≠n vƒÉn th·∫°c sƒ©:

Nghi√™n c·ª©u chuy·ªÉn t·∫£i v√† l·∫≠p l·ªãch t√†i nguy√™n trong MEC.

Nghi√™n c·ª©u di chuy·ªÉn d·ªãch v·ª• trong MEC.

üìå Ph∆∞∆°ng √°n thay th·∫ø UE
1. Synthetic UE tr√™n UPF host (VM3)
T·∫°o namespace m·∫°ng gi·∫£ l·∫≠p UE, g√°n IP t·ª´ subnet m√† UPF qu·∫£n l√Ω (v√≠ d·ª• 10.45.0.2/16).

D√πng curl, iperf3 trong namespace ƒë√≥ ƒë·ªÉ ph√°t sinh traffic qua UPF ‚Üí MEC App.

UPF coi nh∆∞ c√≥ UE th·∫≠t, b·∫°n v·∫´n ƒëo ƒë∆∞·ª£c throughput, latency, resource usage.

∆Øu ƒëi·ªÉm: v·∫´n gi·ªØ nguy√™n ƒë∆∞·ªùng ƒëi qua UPF, ph√π h·ª£p cho nghi√™n c·ª©u scheduling.

2. Traffic generator Pod trong K8s
Deploy m·ªôt Pod ‚Äúloadgen‚Äù (v√≠ d·ª• ch·∫°y iperf3 ho·∫∑c ab/wrk) trong namespace MEC.

Pod n√†y g·ª≠i traffic li√™n t·ª•c t·ªõi MEC App.

B·∫°n ƒëi·ªÅu ch·ªânh resource requests/limits, scheduling policy, ho·∫∑c migration Pod/VM ƒë·ªÉ nghi√™n c·ª©u.

∆Øu ƒëi·ªÉm: ƒë∆°n gi·∫£n, kh√¥ng c·∫ßn RAN, t·∫≠p trung v√†o MEC scheduling/migration.

3. PFCP session emulation
Vi·∫øt script ho·∫∑c d√πng tool g·ª≠i PFCP Session Establishment tr·ª±c ti·∫øp t·ªõi UPF.

Sau ƒë√≥ inject traffic v√†o interface ogstun.

Cho ph√©p b·∫°n nghi√™n c·ª©u UPF/MEC m√† kh√¥ng c·∫ßn NAS/NGAP t·ª´ UE.

üìå Mapping v·ªõi 2 lu·∫≠n vƒÉn
Lu·∫≠n vƒÉn 1 (Scheduling):

D√πng synthetic UE ho·∫∑c loadgen Pod ƒë·ªÉ t·∫°o nhi·ªÅu lu·ªìng traffic.

Thu th·∫≠p metrics t·ª´ Prometheus/Grafana.

√Åp d·ª•ng thu·∫≠t to√°n DRL (DQN/SARSA/PPO) ƒë·ªÉ quy·∫øt ƒë·ªãnh ph√¢n b·ªï t√†i nguy√™n, steering traffic.

Lu·∫≠n vƒÉn 2 (Migration):

Ch·∫°y MEC App trong Pod ho·∫∑c VM (KubeVirt).

D√πng CRIU (container) ho·∫∑c virtctl migrate (VM) ƒë·ªÉ di chuy·ªÉn d·ªãch v·ª•.

Trong l√∫c migration, loadgen/synthetic UE v·∫´n g·ª≠i traffic ‚Üí ƒëo downtime, latency spike.

‚úÖ K·∫øt lu·∫≠n
Kh√¥ng c·∫ßn UE th·∫≠t: b·∫°n v·∫´n m√¥ ph·ªèng ƒë∆∞·ª£c b·∫±ng c√°ch t·∫°o traffic gi·∫£ (synthetic UE ho·∫∑c loadgen Pod).

Scheduling: t·∫≠p trung v√†o ƒëo t√†i nguy√™n khi c√≥ nhi·ªÅu traffic.

Migration: t·∫≠p trung v√†o continuity khi di chuy·ªÉn Pod/VM.

Hai ph∆∞∆°ng √°n thay th·∫ø UE
1. Synthetic UE namespace tr√™n VM3 (WorkerK8s + UPF)
M·ª•c ti√™u: gi·∫£ l·∫≠p UE th·∫≠t, traffic ƒëi qua UPF ‚Üí ogstun ‚Üí MEC App.

·ª®ng d·ª•ng:

Lu·∫≠n vƒÉn 1 (Scheduling): t·∫°o nhi·ªÅu namespace UE, sinh traffic kh√°c nhau, ƒëo throughput/latency qua UPF.

Lu·∫≠n vƒÉn 2 (Migration): trong khi UE gi·∫£ v·∫´n g·ª≠i traffic, b·∫°n di chuy·ªÉn MEC App Pod/VM ‚Üí ƒëo downtime, packet loss.

Th√¥ng s·ªë/bi·ªÉu ƒë·ªì:

N·∫øu ch∆∞a c√†i Prometheus/Grafana, b·∫°n v·∫´n c√≥ th·ªÉ ƒëo b·∫±ng iperf3, tc, curl ƒë·ªÉ l·∫•y s·ªë li·ªáu th√¥ (throughput, RTT, packet loss).

Khi c√†i Prometheus/Grafana, b·∫°n s·∫Ω c√≥ bi·ªÉu ƒë·ªì CPU/RAM/Network c·ªßa UPF v√† MEC App.

Thu·∫≠t to√°n: b·∫°n c√≥ th·ªÉ √°p d·ª•ng DRL (DQN, PPO‚Ä¶) ƒë·ªÉ quy·∫øt ƒë·ªãnh scheduling/migration d·ª±a tr√™n s·ªë li·ªáu thu th·∫≠p.

2. Load generator Pod trong K8s
M·ª•c ti√™u: t·∫°o traffic n·ªôi b·ªô trong cluster t·ªõi MEC App, kh√¥ng c·∫ßn UPF.

·ª®ng d·ª•ng:

Lu·∫≠n vƒÉn 1 (Scheduling): scale nhi·ªÅu Pod loadgen ƒë·ªÉ t·∫°o t·∫£i, √°p d·ª•ng thu·∫≠t to√°n scheduling tr√™n MEC App.

Lu·∫≠n vƒÉn 2 (Migration): di chuy·ªÉn MEC App Pod/VM trong khi loadgen v·∫´n g·ª≠i traffic ‚Üí ƒëo downtime.

Th√¥ng s·ªë/bi·ªÉu ƒë·ªì:

K8s + Prometheus/Grafana s·∫Ω cho b·∫°n metrics chi ti·∫øt (CPU, RAM, network I/O, pod status).

D·ªÖ v·∫Ω bi·ªÉu ƒë·ªì v√† t√≠ch h·ª£p v·ªõi thu·∫≠t to√°n scheduling.

Thu·∫≠t to√°n: thu·∫≠n l·ª£i ƒë·ªÉ th·ª≠ nghi·ªám DRL v√¨ d·ªØ li·ªáu metrics c√≥ s·∫µn qua Prometheus API.




Ti√™u ch√≠	NS-3	Synthetic UE Namespace	Loadgen Pod
Kh·∫£ nƒÉng m√¥ ph·ªèng m·∫°ng	M√¥ ph·ªèng m·∫°ng ƒë·∫ßy ƒë·ªß (RAN, Core Network)	M√¥ ph·ªèng h√†nh vi UE, l∆∞u l∆∞·ª£ng m·∫°ng	M√¥ ph·ªèng t·∫£i, l∆∞u l∆∞·ª£ng m·∫°ng
T√≠nh linh ho·∫°t	Linh ho·∫°t, m√¥ ph·ªèng s√¢u c√°c giao th·ª©c v√† k·ªãch b·∫£n ph·ª©c t·∫°p	Linh ho·∫°t trong m√¥i tr∆∞·ªùng Kubernetes	Linh ho·∫°t trong ki·ªÉm tra t·∫£i m·∫°ng
Y√™u c·∫ßu t√†i nguy√™n	V·ª´a ph·∫£i, kh√¥ng y√™u c·∫ßu ph·∫ßn c·ª©ng th·ª±c t·∫ø	C·∫ßn t√†i nguy√™n Kubernetes, nh∆∞ng kh√¥ng qu√° cao	C·∫ßn t√†i nguy√™n h·ªá th·ªëng m·∫°nh m·∫Ω
·ª®ng d·ª•ng nghi√™n c·ª©u	M√¥ ph·ªèng m·∫°ng di ƒë·ªông, MEC, DRL	M√¥ ph·ªèng l∆∞u l∆∞·ª£ng m·∫°ng, ·ª©ng d·ª•ng MEC	Ki·ªÉm tra hi·ªáu su·∫•t h·ªá th·ªëng, t·∫£i m·∫°ng
∆Øu ƒëi·ªÉm	M√¥ ph·ªèng chi ti·∫øt m·∫°ng di ƒë·ªông, m·ªü r·ªông	D·ªÖ d√†ng tri·ªÉn khai v√† m·ªü r·ªông	Ki·ªÉm tra t·∫£i d·ªÖ d√†ng, c√≥ th·ªÉ m·ªü r·ªông
Nh∆∞·ª£c ƒëi·ªÉm	C·∫ßn ki·∫øn th·ª©c chuy√™n s√¢u, m√¥ ph·ªèng kh√¥ng ho√†n to√†n ch√≠nh x√°c ph·∫ßn c·ª©ng	Kh√¥ng m√¥ ph·ªèng chi ti·∫øt m·∫°ng di ƒë·ªông	Kh√¥ng m√¥ ph·ªèng chi ti·∫øt giao th·ª©c m·∫°ng di ƒë·ªông



Ti√™u ch√≠	NS-3	Synthetic UE namespace	Loadgen Pod
M·ª•c ƒë√≠ch ch√≠nh	M√¥ ph·ªèng m·∫°ng to√†n di·ªán (RAN, Core, giao th·ª©c)	Gi·∫£ l·∫≠p UE th·∫≠t qua UPF/ogstun trong m√¥i tr∆∞·ªùng th·ª±c	Sinh t·∫£i tr·ª±c ti·∫øp trong cluster K8s t·ªõi MEC App
ƒê·ªô ch√≠nh x√°c	Cao, c√≥ th·ªÉ m√¥ ph·ªèng chi ti·∫øt giao th·ª©c, k·ªãch b·∫£n ph·ª©c t·∫°p	Trung b√¨nh, ch·ªâ m√¥ ph·ªèng ƒë∆∞·ªùng ƒëi d·ªØ li·ªáu qua UPF, kh√¥ng c√≥ RAN	Th·∫•p v·ªÅ 5G, nh∆∞ng cao v·ªÅ MEC workload v√† scheduling
ƒê·ªô ph·ª©c t·∫°p tri·ªÉn khai	Cao, c·∫ßn h·ªçc API, vi·∫øt script C++/Python, compile	V·ª´a, ch·ªâ c·∫ßn Linux netns + iptables	Th·∫•p, ch·ªâ c·∫ßn YAML Pod/Service trong K8s
Th√¥ng s·ªë/bi·ªÉu ƒë·ªì	Xu·∫•t d·ªØ li·ªáu chi ti·∫øt (latency, throughput, packet loss, topology)	C√≥ th·ªÉ ƒëo throughput/latency b·∫±ng iperf3, curl; c·∫ßn Prometheus ƒë·ªÉ c√≥ bi·ªÉu ƒë·ªì	D·ªÖ d√†ng t√≠ch h·ª£p Prometheus/Grafana, c√≥ s·∫µn metrics CPU/RAM/Network
Kh·∫£ nƒÉng √°p d·ª•ng thu·∫≠t to√°n	R·∫•t t·ªët cho nghi√™n c·ª©u l√Ω thuy·∫øt, DRL, m√¥ ph·ªèng k·ªãch b·∫£n l·ªõn	C√≥ th·ªÉ √°p d·ª•ng DRL nh∆∞ng ph·∫£i t·ª± thu th·∫≠p s·ªë li·ªáu	R·∫•t thu·∫≠n l·ª£i cho DRL v√¨ metrics c√≥ s·∫µn qua Prometheus API
Ph√π h·ª£p cho lu·∫≠n vƒÉn	N·∫øu mu·ªën nh·∫•n m·∫°nh m√¥ ph·ªèng m·∫°ng 5G/RAN	N·∫øu mu·ªën gi·ªØ ƒë√∫ng ng·ªØ c·∫£nh 5G nh∆∞ng kh√¥ng c√≥ UE th·∫≠t	N·∫øu t·∫≠p trung v√†o MEC scheduling/migration v√† d·ªÖ ra bi·ªÉu ƒë·ªì