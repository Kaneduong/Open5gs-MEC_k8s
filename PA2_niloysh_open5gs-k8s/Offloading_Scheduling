##############
# 10/01/2026 #
##############
Báº¡n lÃ  trá»£ lÃ½ ká»¹ thuáº­t cho bÃ i lab/luáº­n vÄƒn 5G MEC offloading + scheduling trÃªn Kubernetes. HÃ£y luÃ´n bÃ¡m Ä‘Ãºng hiá»‡n tráº¡ng bÃªn dÆ°á»›i (KHÃ”NG giáº£ Ä‘á»‹nh khÃ¡c), vÃ  Ä‘Æ°a ra káº¿ hoáº¡ch/manifest/thiáº¿t káº¿ chi tiáº¿t Ä‘á»ƒ triá»ƒn khai bÆ°á»›c tiáº¿p theo.

=== HIá»†N TRáº NG / Cáº¤U HÃŒNH ÄÃƒ CÃ“ ===
- MÃ´i trÆ°á»ng: Kubernetes cluster gá»“m 4 node:
  1) masterk8s: control-plane + sáº½ dÃ¹ng lÃ m â€œcore/central/cloud computeâ€ (náº¿u cáº§n)
  2) open5gs: worker cháº¡y Open5GS core + Ä‘á»“ng thá»i lÃ  site MEC1
  3) workerk8s: worker lÃ  site MEC2
  4) ue: node dÃ nh cho UERANSIM (UE/gNB), cÃ³ taint Ä‘á»ƒ chá»‰ workload UE/trafficgen Ä‘Æ°á»£c schedule lÃªn
- ÄÃ£ deploy thÃ nh cÃ´ng Open5GS + UERANSIM trÃªn K8s:
  - Core network (AMF/SMF/UPFâ€¦) cháº¡y OK
  - 2 gNB (mec1 vÃ  mec2) + 1 UE
- User-plane OK:
  - UE Registration OK
  - PDU session OK
  - Interface uesimtun0 cÃ³ IP vÃ  ping Internet (8.8.8.8) OK
- Káº¿t ná»‘i N3 Ä‘Ã£ fix báº±ng OVS bridge + VXLAN (Ä‘áº£m báº£o Ä‘Æ°á»ng N3/UE user-plane qua cÃ¡c site hoáº¡t Ä‘á»™ng)
- Mobility test OK:
  - UE Ä‘á»•i TAC tá»« mec1 -> mec2 (handover/reattach theo ká»‹ch báº£n), AMF/gNB2 cÃ³ dáº¥u váº¿t attach + PDU setup
- Má»¥c tiÃªu bÃ i toÃ¡n: dá»±ng 2 MEC service (mec1/mec2) + 1 scheduler/gateway microservice Ä‘á»ƒ cháº¡y 3 thuáº­t toÃ¡n:
  1) Round-robin
  2) Priority-Deadline
  3) Latency-aware
  vÃ  Ä‘o KPI: latency p50/p95/p99, throughput, queue delay/length, CPU/mem, SLA miss (deadline miss), theo cÃ¡c má»©c táº£i light/medium/heavy, cÃ³/khÃ´ng mobility.

=== KIáº¾N TRÃšC MONG MUá»N (Tá»I GIáº¢N, THUYáº¾T PHá»¤C) ===
- UE/Traffic Generator -> gá»i 1 endpoint duy nháº¥t: Gateway/Scheduler (L7)
- Gateway quyáº¿t Ä‘á»‹nh route task tá»›i:
  - MEC1 app (cháº¡y trÃªn node open5gs)
  - MEC2 app (cháº¡y trÃªn node workerk8s)
  - Cloud/Central app (cháº¡y trÃªn node masterk8s) = mÃ´ phá»ng offload â€œlÃªn coreâ€
- LÆ°u Ã½: quyáº¿t Ä‘á»‹nh offloading náº±m á»Ÿ Gateway/Scheduler (application-layer), khÃ´ng náº±m á»Ÿ Open5GS core. Core chá»‰ Ä‘áº£m nhiá»‡m káº¿t ná»‘i 5G SA + user-plane.

=== KHUYáº¾N NGHá»Š / BÆ¯á»šC TIáº¾P THEO PHáº¢I LÃ€M (Æ¯U TIÃŠN) ===
1) Chá»‘t placement báº±ng label/affinity:
   - Label node:
     - open5gs: mec-site=mec1
     - workerk8s: mec-site=mec2
     - masterk8s: mec-site=cloud (hoáº·c cloud=true)
     - ue: role=ue
   - Táº¡o namespace â€œmecâ€
   - Thiáº¿t káº¿ toleration/nodeSelector Ä‘á»ƒ trafficgen/UE luÃ´n náº±m á»Ÿ node ue
2) Dá»±ng 3 compute service Ä‘Æ¡n giáº£n (mec1/mec2/cloud):
   - Má»—i service cÃ³ API nháº­n request gá»“m: request_id, task_size, cpu_ms(or mi), deadline_ms, priority
   - mec1 Deployment nodeSelector mec-site=mec1
   - mec2 Deployment nodeSelector mec-site=mec2
   - cloud Deployment nodeSelector mec-site=cloud (masterk8s)
   - Set resources requests/limits Ä‘á»ƒ táº¡o ngháº½n cÃ³ kiá»ƒm soÃ¡t
3) Dá»±ng Gateway/Scheduler:
   - Config ALG=rr|pq|latency
   - Log JSON 1 dÃ²ng/req vÃ  Ä‘o:
     - t1_recv, decision_site, queue_wait_ms, t2_send
   - Thá»±c hiá»‡n decision rule vÃ  3 thuáº­t toÃ¡n:
     - RR: luÃ¢n phiÃªn
     - PQ: Æ°u tiÃªn theo priority/deadline
     - Latency-aware: cost = a*RTT(UE->site) + b*queue_wait(site) + c*exec_estimate(site)
4) Traffic generator tá»« UE node:
   - Pod trafficgen pinned vÃ o node ue
   - Cháº¡y test light/medium/heavy; (tuá»³ chá»n) mÃ´ phá»ng khÃ¡c RTT báº±ng tc netem theo Ä‘Ã­ch mec1/mec2/cloud
5) KPI & thu tháº­p dá»¯ liá»‡u (tá»‘i thiá»ƒu trÆ°á»›c, Prometheus sau):
   - E2E latency p50/p95/p99 (UE Ä‘o t0_send -> t3_recv)
   - Throughput req/s
   - Queue delay/length (gateway Ä‘o)
   - CPU/mem: kubectl top / metrics
   - SLA miss rate: % request hoÃ n thÃ nh sau deadline
6) Ma tráº­n thÃ­ nghiá»‡m tá»‘i thiá»ƒu:
   - Algorithm: RR | PQ | Latency-aware
   - Load: L/M/H
   - UE count: 1 / 5 / 20 (tÃ¹y nÄƒng lá»±c)
   - Mobility: static | Ä‘á»•i TAC mec1<->mec2
   - Deadline mix: tight vs loose, priority ratio (vd 20/80)

=== QUY Táº®C OFFLOAD Äá»€ XUáº¤T (RÃ• RÃ€NG Äá»‚ CHá»¨NG MINH) ===
- predicted_finish(site) = now + queue_wait_est(site) + exec_est(site)
- Náº¿u predicted_finish(nearest_edge) > deadline => offload cloud
- Náº¿u queue_len_edge > Q hoáº·c cpu_edge > C => offload cloud
- NgÆ°á»£c láº¡i => chá»n nearest edge (mec1/mec2) theo RTT/TAC; trong latency-aware dÃ¹ng cost nhá» nháº¥t.

=== YÃŠU Cáº¦U Äáº¦U RA Tá»ª Báº N (CHATGPT) ===
- Äá»«ng há»i láº¡i cÃ¡c thÃ´ng tin Ä‘Ã£ nÃªu. Náº¿u thiáº¿u, hÃ£y Ä‘Æ°a giáº£ Ä‘á»‹nh rÃµ rÃ ng vÃ  há»£p lÃ½.
- HÃ£y táº¡o:
  1) Danh sÃ¡ch manifest Kubernetes (Deploy/Service/ConfigMap) cho mec1/mec2/cloud/gateway/trafficgen (cÃ³ nodeSelector+tolerations)
  2) Thiáº¿t káº¿ API + format log JSON chuáº©n hoÃ¡ + cÃ¡ch tÃ­nh KPI
  3) Ká»‹ch báº£n cháº¡y benchmark (lá»‡nh cháº¡y, tham sá»‘ L/M/H, sá»‘ req, concurrency)
  4) CÃ¡ch ghi káº¿t quáº£ ra CSV vÃ  gá»£i Ã½ plot 4 biá»ƒu Ä‘á»“ chÃ­nh: latency p95, throughput, SLA miss, CPU util theo táº£i
- Æ¯u tiÃªn giáº£i phÃ¡p nhanh ra sá»‘ liá»‡u Ä‘á»ƒ viáº¿t bÃ¡o cÃ¡o, sau Ä‘Ã³ má»›i tá»‘i Æ°u/Prometheus/Grafana.

Báº¯t Ä‘áº§u tá»« bÆ°á»›c 1: Ä‘á» xuáº¥t cá»¥ thá»ƒ label/toleration/nodeSelector vÃ  skeleton manifest cho 3 compute service + gateway.

##############
# 01/01/2026 #
##############

PROMPT (Äá»€ TÃ€I 1 â€“ MEC Offloading & Scheduling)

MÃ¬nh Ä‘ang mÃ´ phá»ng 5G SA + MEC báº±ng Open5GS + UERANSIM trÃªn Kubernetes Ä‘á»ƒ lÃ m Ä‘á» tÃ i:
â€œNghiÃªn cá»©u chuyá»ƒn táº£i vÃ  láº­p lá»‹ch tÃ i nguyÃªn trong máº¡ng MECâ€.

1) MÃ´ hÃ¬nh há»‡ thá»‘ng hiá»‡n táº¡i
K8s cluster cÃ³ nhiá»u node:
masterk8s (Ä‘iá»u phá»‘i, cÃ³ Open5GS control-plane)
open5gs (site MEC1)
workerk8s (site MEC2)
ue (node cháº¡y UE pod)
Open5GS core: AMF cháº¡y NGAP trÃªn 10.10.3.200:38412 (multus interface n3).
2 gNB UERANSIM (mÃ´ phá»ng 2 vÃ¹ng MEC):
gNB mec1: ngapIp/gtpIp=10.10.3.231, tac=1, cellid=0x10
gNB mec2: ngapIp/gtpIp=10.10.3.232, tac=2, cellid=0x11
UE UERANSIM:
SUPI imsi-001010000000001, DNN internet, slice sst=1 sd=000001
Registration OK, PDU session OK
uesimtun0 Ä‘Æ°á»£c cáº¥p IP (vÃ­ dá»¥ 10.41.0.x)
Ping 8.8.8.8 OK tá»« UE pod â†’ user-plane ra Internet hoáº¡t Ä‘á»™ng.
Káº¿t ná»‘i N3 giá»¯a cÃ¡c node Ä‘Æ°á»£c fix báº±ng OVS bridge n3br + VXLAN (key=103, udp/4789) Ä‘á»ƒ Ä‘áº£m báº£o gNBâ†”AMF ping Ä‘Æ°á»£c vÃ  SCTP NG Setup OK.
Mobility test Ä‘Ã£ chá»©ng minh UE chuyá»ƒn TAC:
UE log: â€œSelected cell tac[1] â€¦â€ rá»“i sau Ä‘Ã³ â€œSelected cell tac[2] â€¦â€
AMF log: nháº­n InitialUEMessage vá»›i TAC[1] CellID[0x10] vÃ  sau Ä‘Ã³ TAC[2] CellID[0x11]
gNB mec2 log: nháº­n Initial NAS + Initial Context Setup + PDU session resources setup cho UE.

2) Má»¥c tiÃªu Ä‘á» tÃ i 1 (Offloading & Scheduling trong MEC)
MÃ¬nh muá»‘n xÃ¢y dá»±ng mÃ´ hÃ¬nh offloading: UE gá»­i task (request) tá»›i MEC, MEC quyáº¿t Ä‘á»‹nh:
xá»­ lÃ½ á»Ÿ MEC1/MEC2 (edge) hoáº·c offload lÃªn cloud (náº¿u cÃ³), vÃ 
láº­p lá»‹ch tÃ i nguyÃªn compute/network táº¡i MEC.
MÃ¬nh cáº§n báº¡n hÆ°á»›ng dáº«n theo cÃ¡c pháº§n:

MÃ´ hÃ¬nh hoÃ¡ bÃ i toÃ¡n:
Task model: kÃ­ch thÆ°á»›c input, sá»‘ chu ká»³ CPU/MI, deadline/latency budget, Ä‘á»™ Æ°u tiÃªn.
MEC resource model: CPU cores, queue, service rate, giá»›i háº¡n Ä‘á»“ng thá»i.
Network model: RTT UEâ†’MEC, bandwidth giáº£ láº­p, latency theo site (mec1 vs mec2).
Objective: minimize latency/violation, maximize throughput, fairness, utilization, minimize drops.
Thiáº¿t káº¿ & triá»ƒn khai 3 thuáº­t toÃ¡n láº­p lá»‹ch Ä‘á»ƒ so sÃ¡nh:
Round-robin
Priority queue (theo priority/deadline)
Latency-aware (chá»n MEC site + thá»© tá»± xá»­ lÃ½ Ä‘á»ƒ giáº£m E2E latency; cÃ³ thá»ƒ dÃ¹ng cost function)
Sinh lÆ°u lÆ°á»£ng báº±ng UERANSIM:
Tá»« UE pod táº¡o traffic HTTP/UDP (nhiá»u flow) hoáº·c nhiá»u UE pod (ue1, ue2, â€¦).
Control biáº¿n: request rate, packet size, burst, sá»‘ UE, tá»‰ lá»‡ task priority.
Äo KPI (chÆ°a cÃ³ Prometheus/Grafana):
End-to-end latency (client timestamp)
Task completion time / response time distribution (p50/p95/p99)
Throughput (req/s, Mbps)
Packet loss / retries
Queueing delay, queue length
CPU/memory utilization táº¡i MEC pods (kubectl top / cgroup stats)
SLA violation rate (deadline miss)
PhÃ¢n tÃ­ch & Ä‘Ã¡nh giÃ¡:
So sÃ¡nh 3 thuáº­t toÃ¡n theo KPI á»Ÿ nhiá»u má»©c táº£i (light/medium/heavy)
Nháº­n xÃ©t trade-off: latency vs fairness vs utilization
Káº¿t luáº­n thuáº­t toÃ¡n nÃ o phÃ¹ há»£p Ä‘iá»u kiá»‡n MEC (nhiá»u UE, mobility, bursty traffic)
Äá» xuáº¥t cáº£i tiáº¿n (hybrid, admission control, dynamic weights)

3) Hiá»‡n tráº¡ng / cáº§n lÃ m tiáº¿p ngay
Hiá»‡n core + gNB + UE Ä‘Ã£ hoáº¡t Ä‘á»™ng vÃ  cÃ³ Internet tá»« UE pod.
ChÆ°a cÃ i Prometheus/Grafana.
MÃ¬nh muá»‘n báº¯t Ä‘áº§u theo hÆ°á»›ng dá»±ng 2 MEC service (mec1/mec2) + má»™t scheduler/gateway (cÃ³ thá»ƒ lÃ  1 microservice) Ä‘á»ƒ thá»±c thi 3 thuáº­t toÃ¡n vÃ  Ä‘o KPI.
HÃ£y Ä‘á» xuáº¥t kiáº¿n trÃºc triá»ƒn khai cá»¥ thá»ƒ trÃªn K8s (pods/services, nodeSelector cho mec1/mec2), cÃ¡ch sinh traffic tá»« UE, cÃ¡ch log/thu tháº­p sá»‘ liá»‡u, vÃ  káº¿ hoáº¡ch thÃ­ nghiá»‡m (matrix cÃ¡c test cases).

ğŸ‘‰ HÃ£y tráº£ lá»i nhÆ° má»™t â€œroadmap thá»±c thi + checklist command-levelâ€, chia rÃµ tá»«ng bÆ°á»›c triá»ƒn khai vÃ  tá»«ng loáº¡i output cáº§n thu Ä‘á»ƒ viáº¿t luáº­n vÄƒn (hÃ¬nh/biá»ƒu Ä‘á»“/báº£ng so sÃ¡nh).
